(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{77:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return u}));var i=s(3),o=s(4);const n=Symbol("enforcement-ready"),r=Symbol("enforcement-loading"),a=Symbol("enforcement-running");let h=null;class m{constructor(e){this.config=e,this.csrftoken="",this.capture=null,this.enforcement=null,this.state=r,this.bindGlobalArkoseCallback(),this.injectArkoseJavascript()}attach(e){this.csrftoken=e.pluckCsrfToken(),this.capture=e,this.emitState(this.state)}detach(e){this.capture===e&&(this.capture=null)}emitToken(e){this.capture&&this.capture.onChallengeComplete(e)}emitState(e){this.state=e,this.capture&&this.capture.onStateChange(this.state)}run(){this.enforcement&&this.enforcement.run()}injectArkoseJavascript(){this.arkoseReadyTimeout=setTimeout(this.onArkoseReadyTimeout.bind(this),this.config.readyTimeout),this.stopReadyTimer=this.startTimer("ready");const e=document.createElement("script");e.src=this.config.src,e.setAttribute("data-callback","blz-arkose-callback"),e.setAttribute("id","arkose-script"),document.head.appendChild(e)}bindEnforcementConfig(){this.enforcement.setConfig({onCompleted:e=>{console.debug("arkose -- completed"),this.emitToken(e.token),this.emitState(r),this.arkoseResetTimeout=setTimeout(this.onArkoseResetTimeout.bind(this),this.config.readyTimeout),this.stopChallengeCompleteTimer(),this.stopResetTimer=this.startTimer("reset")},onReady:()=>{console.debug("arkose -- ready"),this.emitState(n),clearTimeout(this.arkoseReadyTimeout),this.stopReadyTimer()},onHide:()=>{console.debug("arkose -- hide"),this.state!=r&&this.emitState(n),clearTimeout(this.arkoseShownTimeout)},onShow:()=>{console.debug("arkose -- show"),this.emitState(a),this.stopChallengeShownTimer=this.startTimer("challenge-shown"),this.arkoseShownTimeout=setTimeout(this.onArkoseShownTimeout.bind(this),this.config.shownTimeout)},onShown:()=>{console.debug("arkose -- shown"),clearTimeout(this.arkoseShownTimeout),this.stopChallengeShownTimer(),this.stopChallengeCompleteTimer=this.startTimer("challenge-complete")},onReset:()=>{console.debug("arkose -- reset"),this.emitState(n),clearTimeout(this.arkoseResetTimeout),this.stopResetTimer()},onSuppress:()=>console.debug("arkose -- suppress")})}bindGlobalArkoseCallback(){window["blz-arkose-callback"]=e=>{this.enforcement=e,this.bindEnforcementConfig()}}onArkoseReadyTimeout(){this.sendTelemetry({name:"ready-timeout",type:"timeout",durationMillis:this.config.readyTimeout})}onArkoseResetTimeout(){this.sendTelemetry({name:"reset-timeout",type:"timeout",durationMillis:this.config.readyTimeout})}onArkoseShownTimeout(){this.sendTelemetry({name:"challenge-shown-timeout",type:"timeout",durationMillis:this.config.shownTimeout})}startTimer(e){const t=Date.now();return()=>{const s=Date.now();this.sendTelemetry({name:e,type:"timer",startEpochMillis:t,endEpochMillis:s})}}sendTelemetry(e){return Object(o.a)({url:`${this.config.telemetryUrl}?csrftoken=${this.csrftoken}`,method:"POST",data:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}}class u extends i.a{constructor(e){super("arkose",e),this.fulfilled=!1}_bind(){super._bind(),h||(h=new m(this.pluckConfigurationAttributes())),h.attach(this),this.bindEnforcementToFormButton()}_release(){h.detach(this)}onChallengeComplete(e){this.fulfilled=!0,this.setInputValue(e),this.unbindEnforcementFromFormButton(),this.enableForm(),this.submitForm()}onStateChange(e){if(!this.fulfilled)switch(e){case n:this.setInputValue(""),this.enableForm();break;case a:this.disableForm();break;case r:this.disableFormLoading()}}unbindEnforcementFromFormButton(){this.findFormButton().removeEventListener("click",this.enforcementListener,{capture:!0})}bindEnforcementToFormButton(){this.unbindEnforcementFromFormButton();const e=this.enforcementListener=e=>{e.stopImmediatePropagation(),e.preventDefault(),h.run()};this.findFormButton().addEventListener("click",e,{capture:!0})}setInputValue(e){this.findInputElement().value=e}pluckConfigurationAttributes(){const e=this.findInputElement();return{readyTimeout:Number(e.getAttribute("data-arkose-ready-timeout")),shownTimeout:Number(e.getAttribute("data-arkose-shown-timeout")),src:e.getAttribute("data-arkose-src"),telemetryUrl:e.getAttribute("data-arkose-telemetry-url")}}pluckCsrfToken(){const e=this.node("flow-csrftoken");return e&&e.value||""}}}}]);