$("#submit").addClass("unbind"),$(function(){loginForm.init(),InfoPanel.init(),EmbeddedLogin.init()});var loginForm={accountName:$("#accountName"),alertCookie:$("#cookie-check"),alertHolder:$("#display-errors"),alertJsHolder:$("#js-errors"),csrfTokenFields:$('input[name="csrftoken"]'),password:null,passwordForm:$("#password-form"),passwordFill:".",submitButton:$("#submit"),srpClientSession:null,srpClientCredentials:null,inputPassword:$("#password"),inputUpgradeVerifier:$("#upgradeVerifier"),inputUseSrp:$("#useSrp"),inputSrpEnabled:$("#srpEnabled"),inputPublicA:$("#publicA"),inputClientEvidenceM1:$("#clientEvidenceM1"),networkErrorMessage:$("body").attr("data-network-error-message"),thirdPartyLoginButtons:$("form.third-party-login button"),loadedTime:(new Date).getTime(),csrfTokenRefreshIntervalMillis:6e5,focusDelay:500,preventDefault:function(e){e.preventDefault()},init:function(){this.setSubmitButtonDisabled(),this.checkCookie(),this.setSrpAjaxCall(),this.setCaptcha(loginForm.passwordForm),this.initThirdPartyLoginButtons(),this.initPasswordFields(),this.setFocus(),this.showInitialErrors()},setSrpAjaxCall:function(){this.submitButton.bind("click",this.preventDefault).click(function(){try{loginForm.getSrpData(Core.locale)}catch(e){setTimeout(function(){loginForm.submitButton.removeAttr("disabled").unbind("click").click()})}})},setSubmitButtonDisabled:function(){this.submitButton.removeClass("unbind")},checkCookie:function(){var e=navigator.cookieEnabled;e||($(loginForm.alertCookie).removeClass("hide"),$(loginForm.alertJsHolder).removeClass("hide"))},setFocus:function(){if("responsive"!==Core.userAgent){const e=document.querySelector(".field-error");if(e&&"INPUT"===e.nodeName)return void setTimeout(function(){e.focus(),e.click()},this.focusDelay);loginForm.accountName.val()?loginForm.inputPassword.focus():loginForm.accountName.focus()}},showInitialErrors:function(){var e=this.alertHolder;e.length&&setTimeout(function(){e.show()},this.focusDelay-100)},setCaptcha:function(e){e.hasClass("captcha-required")&&$("#captcha-anchor").click(function(e){e.preventDefault(),$("#sec-string").attr("src","/login/captcha.jpg?"+(new Date).getTime())})},getSrpData:function(e){var r=this,t=loginForm.passwordForm.find('input[name="accountName"]').val();

$.ajax({
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    },
    method:"POST",
    url:"/login/srp?csrfToken=true",
    data:JSON.stringify({inputs:[{input_id:"account_name",value:t}]}),dataType:"json",beforeSend:function(r){r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept-Language",e)}}).done(function(e){loginForm.onSuccess(e).then(function(){r.submitForm()})["catch"](function(e){r.submitForm()})}).fail(function(e){loginForm.onFail(e)})},submitForm:function(){loginForm.submitButton.removeAttr("disabled").unbind("click").click().addClass("unbind")},onSuccess:function(e){if("false"===this.inputSrpEnabled.val())return Promise.resolve();var r=this;return loginForm.updateCsrfTokenFields(e.csrf_token),r.password=r.inputPassword.val(),r.srpClientSession=new srp6aRoutines.ClientSession(e.modulus,e.generator,e.hash_function,e.version,e.iterations,e.eligible_credential_upgrade,window.serverResourceUrl),r.srpClientSession.step1(e.username,r.password,e.salt,e.public_B).then(function(t){return r.srpClientCredentials=t,null!==r.password&&r.inputPassword.val(Array(r.password.length+1).join(r.passwordFill)),1===e.version&&e.eligible_credential_upgrade&&"false"!==r.inputSrpEnabled.val()?new Promise(function(t){var i=new Worker(window.upgradeResourceUrl);i.onmessage=function(e){var s=e.data[0];r.inputUpgradeVerifier.val(s),r.fillSrpFields(),i.terminate(),t()},i.postMessage([window.accountPasswordUrl,e,r.password])}):void r.fillSrpFields()})},fillSrpFields:function(){this.inputPublicA.val(this.srpClientCredentials.publicA.toString(16)),this.inputClientEvidenceM1.val(this.srpClientCredentials.clientEvidenceM1.toString(16)),this.inputUseSrp.val("true")},errorCleanup:function(){var e=$(".error-helper");loginForm.alertHolder.length&&loginForm.alertHolder.remove(),e.text().trim().length&&e.empty().hide(),$(".status-warning").removeClass("status-warning"),$(".status-error").removeClass("status-error"),$(".field-error").removeClass("field-error"),$(".control-error").removeClass("control-error"),$("input[aria-invalid=true]").attr("aria-invalid","false")},onFail:function(e){var r={errorCode:"",supportCode:"",subtextHtml:"",errorMessage:"",errorStatus:"error",errorAria:""};if(navigator.onLine&&0!=e.status){var t=JSON.parse(e.responseText);r.errorCode=t.error_code||"",r.supportCode=t.support_error_code||"",r.errorMessage=t.error_message,r.errorMessageSubtext=t.error_message_subtext||"",r.errorMessageHelper=t.error_message_helper||"",r.errorStatus=t.error_status.toLowerCase()||"error",r.errorAria=r.errorMessage}else r.errorCode="NETWORK_ERROR",r.errorMessage=loginForm.networkErrorMessage;if(this.errorCleanup(),r.errorMessageSubtext&&(r.subtextHtml="<p class='error-message-subtext' tabIndex='0'>"+r.errorMessageSubtext+"</p>",r.errorAria+=r.errorMessageSubtext),r.errorMessageHtml="<p class='error-message-heading' tabIndex='0'>"+r.errorMessage+"</p>"+r.subtextHtml,r.supportCode){var i=loginForm.alertJsHolder.attr("data-support-aria"),s=i?'aria-label="'+i+'"':"";r.errorMessageHtml+="<a tabIndex='0' href='"+Core.secureSupportUrl+"article/"+r.supportCode+"' rel='external' target='_blank' "+s+" role='link'>"+r.supportCode+"</a>"}if(r.errorMessageHelper&&t.input_id&&(r.errorMessageHtml+="<p class='hide-text'>"+r.errorMessageHelper+"</p>"),loginForm.alertJsHolder.html(r.errorMessageHtml).removeClass("hide").removeClass("alert-error"),loginForm.alertJsHolder.addClass("alert-"+r.errorStatus),r.errorMessageHelper&&t.input_id){var o=window.Utility.getInputId(t.input_id),n=$("#"+o),a=n.siblings(".error-helper");n.addClass("status-"+r.errorStatus),n.addClass("field-error"),n.attr("aria-invalid","true"),a.html(r.errorMessageHelper).removeClass("hide").addClass("status-"+r.errorStatus).attr("style","display: block;")}this.inputPassword.val(""),loginForm.submitButton.button("reset"),EmbeddedLogin.errorHandlerRegistration&&EmbeddedLogin.errorHandlerRegistration(r.errorCode,r.supportCode,r.errorMessage);var l;l=r.errorMessageHelper&&t.input_id&&n?n:loginForm.accountName,setTimeout(function(){l.click().focus()},this.focusDelay)},calculateTogglePadding:function(e,r){var t=function(e){return parseInt(e.replace(/[^-?\d*]/g,""))},i=t(r.css("padding-left"))+r.width()+t(r.css("padding-right"));i>0&&e.css("padding-right",i+"px")},updateCsrfTokenFields:function(e){[this.csrfTokenFields].forEach(function(r){r.val(e)})},refreshCsrfToken:function(e){$.ajax({method:"POST",url:"/login/csrf-token",async:!1}).done(function(r){loginForm.updateCsrfTokenFields(r),$(e.target).unbind("click").click()})},initThirdPartyLoginButtons:function(){(new Date).getTime();[this.thirdPartyLoginButtons].forEach(function(e){e.bind("click",this.preventDefault).click(function(e){loginForm.refreshCsrfToken(e)})})},initPasswordFields:function(){if(null!=BlzPassword){var e=new BlzPassword(document.querySelector("#password"));e.init()}}},InfoPanel={cssHide:"hide",cssShow:"show",cssGrid:"info-active",leftPanel:"#info-wrapper",rightPanel:"#login-wrapper",phoneInfoToggle:"#info-phone-toggle",phoneInfoClose:"#info-phone-close",title:null,body:null,enabled:null,domReady:!1,init:function(){this.domReady=!0,this.$leftPanel=$(this.leftPanel),this.$rightPanel=$(this.rightPanel),this.$mobileToggle=$(this.phoneInfoToggle),this.$mobileClose=$(this.phoneInfoClose),this.enabled&&this.toggle(this.enabled,this.title,this.body),this.enableMobile()},toggle:function(e,r,t){this.title=r,this.body=t,this.enabled=e;var i="InfoPanel.toggle called.";return this.domReady&&(e?(this.$leftPanel.find(".info-title").html(r),this.$leftPanel.find(".info-body").html(t),this.$mobileToggle.html(r),this.$leftPanel.removeClass(this.cssHide),this.$rightPanel.addClass(this.cssGrid),this.$mobileToggle.removeClass(this.cssHide)):(this.$leftPanel.addClass(this.cssHide),this.$rightPanel.removeClass(this.cssGrid),this.$mobileToggle.addClass(this.cssHide)),i+="Dom ready."),i},enableMobile:function(){var e=this,r=function(e,r,t){e.stopPropagation(),e.preventDefault(),r.removeClass(InfoPanel.cssHide),t.addClass(InfoPanel.cssHide)};this.$mobileToggle.on("click",function(t){r(t,e.$leftPanel,e.$rightPanel)}),this.$mobileClose.on("click",function(t){r(t,e.$rightPanel,e.$leftPanel)})}},EmbeddedLogin={inputAccountName:null,inputPassword:null,inputPersistLogin:$("#persistLogin"),inputAccountNameId:"accountName",inputPasswordId:"password",errorContainer:null,errorContainerId:"#display-errors",jsErrorContainer:null,jsErrorContainerId:"#js-errors",errorHandlerRegistration:null,init:function(){return this.inputAccountName=document.getElementById(this.inputAccountNameId),this.inputPassword=document.getElementById(this.inputPasswordId),this.errorContainer=$(this.errorContainerId),this.jsErrorContainer=$(this.jsErrorContainerId),this},getSubmitButton:function(){return loginForm.submitButton[0]},fillAccountName:function(e){return e?this.inputAccountName.value=e.substring(0,Math.min(320,e.length)):this.inputAccountName.value="",this},fillPassword:function(e){return e?this.inputPassword.value=e.substring(0,Math.min(128,e.length)):this.inputPassword.value="",this},setPersistLogin:function(e){this.inputPersistLogin&&this.inputPersistLogin.prop("checked",e)},registerErrorHandler:function(e){this.errorHandlerRegistration=e}};
